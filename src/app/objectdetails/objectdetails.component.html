<div *ngIf="loading |async">
    <mat-progress-bar mode="buffer"></mat-progress-bar>
</div>

<div *ngIf="(mediaobject|async) as obj" style="padding:10px;">
    <app-objectviewer #objectviewerComponent [mediaobject]="obj"></app-objectviewer>

    <div *ngIf="(obj.segmentsObservable |async) as segments">

        <mat-tab-group>
            <mat-tab label="Segments ({{segments.length}})">
                <div fxLayout="row" fxLayoutGap="5px" fxLayoutWrap="wrap">
                    <div (dragstart)="onSegmentDrag($event, segment)"
                         *ngFor="let segment of (segments | orderBy:orderType)" class="tile"
                         draggable="true" fxFlex="200px">
                        <div class="tile-header" fxLayout fxLayoutAlign="space-between start">
                            <p [style.margin]="'0'">{{segment.segmentId}} ({{segment.scorePercentage}}&#37;)</p>
                            <p *ngIf="segment.endabs > 0" [style.margin]="'0'">{{segment.startabs.toFixed(2)}}
                                - {{segment.endabs.toFixed(2)}}</p>
                        </div>

                        <img class="tile-body" height="200px"
                             src="{{_resolver.pathToThumbnail(segment.objectScoreContainer,segment)}}"
                             width="200px">

                        <div class="tile-footer" fxLayout="row-reverse">
                            <button (click)="onPlayClick(segment)"
                                    *ngIf="(mediaobject|async).mediatype == 'VIDEO' || (mediaobject|async).mediatype == 'AUDIO'"
                                    mat-icon-button matTooltip="Start playback">
                                <mat-icon>play_arrow</mat-icon>
                            </button>
                            <button (click)="onMltClick(segment)" mat-icon-button matTooltip="More-like-this">
                                <mat-icon>youtube_searched_for</mat-icon>
                            </button>
                            <button (click)="onInformationButtonClicked(segment)" mat-icon-button
                                    matTooltip="Metadata">
                                <mat-icon>help</mat-icon>
                            </button>
                            <button (click)="onLoadFeaturesButtonClicked(segment)" mat-icon-button
                                    matTooltip="Load Features">
                                <mat-icon>remove_red_eye</mat-icon>
                            </button>
                        </div>
                    </div>
                </div>
                <button (click)="onLoadAllButtonClicked(segments[0])" color="warn" mat-raised-button
                        matTooltip="Load all segments">
                    <mat-icon>all_inclusive</mat-icon>
                    Load all
                </button>

            </mat-tab>


            <mat-tab label="Metadata ({{(mediaobject|async).metadata.size}})">
                <mat-list>
                    <mat-list-item *ngFor="let metadatum of (mediaobject|async).metadata | keyvalue">
                        <h4 mat-line><strong>{{metadatum.key}}</strong></h4>
                        <p [innerHTML]="textWithLink(metadatum.value)" mat-line style="white-space: pre-wrap;"></p>
                    </mat-list-item>
                </mat-list>
            </mat-tab>
        </mat-tab-group>
    </div>


    <div *ngIf="_activeSegmentId">

        <h4><strong>Features for segment: {{_activeSegmentId}}</strong></h4>
        <mat-tab-group class="scrollToBottom">

            <mat-tab label="Tags">
                <div *ngIf="!_tagsPerSegment">
                    <p class="text-muted">No Tags available for chosen element</p>
                </div>
                <div *ngIf="_tagsPerSegment">
                    <h4 mat-line *ngIf="_tagsPerSegment.length>0"><strong>Tags</strong></h4>
                    <mat-grid-list cols="5" rowHeight="3:1">
                        <mat-grid-tile class="smallerFont"
                                       *ngFor="let tag of sortAlphabetically(_tagsPerSegment)">
                            <div>{{tag.name}}
                                <br>
                                ({{tag.id}})
                            </div>
                        </mat-grid-tile>
                    </mat-grid-list>

                </div>
            </mat-tab>

            <mat-tab *ngIf="_captionsPerSegment.length>0" label="Captions">
                <h4 mat-line><strong>Captions</strong></h4>
                <div class="normalfont"
                     *ngFor="let caption of _captionsPerSegment index as i; odd as isOdd; even as isEven"
                     [class.Odd]="isOdd"
                     [class.even]="isEven">
                    {{caption}}
                </div>
            </mat-tab>

            <mat-tab *ngIf="_asrPerSegment.length>0" label="ASR">
                <h4 mat-line><strong>ASR</strong></h4>
                <div class="normalfont"
                     *ngFor="let asr of _asrPerSegment index as i; odd as isOdd; even as isEven"
                     [class.Odd]="isOdd"
                     [class.even]="isEven">
                    {{asr}}
                </div>
            </mat-tab>

            <mat-tab *ngIf="_ocrPerSegment.length>0" label="OCR">
                <h4 mat-line><strong>OCR</strong></h4>
                <div class="normalfont"
                     *ngFor="let ocr of _ocrPerSegment index as i; odd as isOdd; even as isEven"
                     [class.Odd]="isOdd"
                     [class.even]="isEven">
                    {{ocr}}
                </div>
            </mat-tab>
        </mat-tab-group>
    </div>


    <div #cloud class="tag-cloud"></div>
</div>
